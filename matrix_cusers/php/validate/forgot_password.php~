<?php

// check if user exists
$checkUser = $this->matrix->query('SELECT id, username, email FROM '.self::TABLE_USERS.' WHERE email = "'.$email.'"', 'SINGLE');

if ($checkUser) {
  // send email
  $to = $email;
  $subject = get_site_name().' - '.i18n_r('FORGOT_PASSWORD');
  $newPassword = $this->randomString();
  $message = '<p>U: '.$checkUser['username'].'</p><p>'.$newPassword.'</p>';
  $mail = mail($to, $subject, $message);
  if ($mail) {
   // only change the password if the email is sent
   $changePass = $this->matrix->updateRecord(self::TABLE_USERS, $checkUser['id'], array('password' => $newPassword));  
   if ($changePass) $return = true;
   else $return = false;
  }
  else $return = false;
}
else $return = false;

?>
